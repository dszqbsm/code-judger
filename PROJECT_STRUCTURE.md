# é¡¹ç›®ç»“æ„è¯´æ˜

## ğŸ“ ç›®å½•ç»“æ„

```
code-judger/                           # é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ README.md                          # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ go.mod                             # Goæ¨¡å—å®šä¹‰
â”œâ”€â”€ go.sum                             # Goæ¨¡å—æ ¡éªŒå’Œ
â”œâ”€â”€ Makefile                           # æ„å»ºå’Œéƒ¨ç½²è„šæœ¬
â”œâ”€â”€ docker-compose.yml                 # Dockerç¼–æ’é…ç½®
â”œâ”€â”€ start-user-api.sh                  # ç”¨æˆ·APIæœåŠ¡å¯åŠ¨è„šæœ¬
â”œâ”€â”€ PROJECT_STRUCTURE.md               # é¡¹ç›®ç»“æ„è¯´æ˜(æœ¬æ–‡ä»¶)
â”‚
â”œâ”€â”€ docs/                              # ğŸ“š æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ APIæ¥å£æ–‡æ¡£.md                  # å®Œæ•´çš„APIæ¥å£æ–‡æ¡£
â”‚   â”œâ”€â”€ æ•°æ®åº“è¡¨è®¾è®¡.md                 # æ•°æ®åº“è®¾è®¡æ–‡æ¡£
â”‚   â””â”€â”€ æŠ€æœ¯é€‰å‹åˆ†æ.md                 # æŠ€æœ¯é€‰å‹åˆ†ææ–‡æ¡£
â”‚
â”œâ”€â”€ sql/                               # ğŸ—„ï¸ æ•°æ®åº“è„šæœ¬
â”‚   â””â”€â”€ init.sql                       # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚
â”œâ”€â”€ docker/                            # ğŸ³ Dockeré…ç½®
â”‚   â”œâ”€â”€ mysql/                         # MySQLé…ç½®
â”‚   â”œâ”€â”€ redis/                         # Redisé…ç½®
â”‚   â”œâ”€â”€ consul/                        # Consulé…ç½®
â”‚   â”œâ”€â”€ prometheus/                    # Prometheusé…ç½®
â”‚   â”œâ”€â”€ grafana/                       # Grafanaé…ç½®
â”‚   â”œâ”€â”€ kibana/                        # Kibanaé…ç½®
â”‚   â””â”€â”€ logstash/                      # Logstashé…ç½®
â”‚
â”œâ”€â”€ common/                            # ğŸ”§ é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ types/                         # å…¬å…±ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ user.go                    # ç”¨æˆ·ç›¸å…³ç±»å‹
â”‚   â”œâ”€â”€ utils/                         # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ hash.go                    # å¯†ç å“ˆå¸Œå·¥å…·
â”‚   â”‚   â”œâ”€â”€ jwt.go                     # JWTå·¥å…·
â”‚   â”‚   â””â”€â”€ response.go                # å“åº”æ ¼å¼å·¥å…·
â”‚   â””â”€â”€ middleware/                    # å…¬å…±ä¸­é—´ä»¶
â”‚
â””â”€â”€ services/                          # ğŸš€ å¾®æœåŠ¡ç›®å½•
    â”œâ”€â”€ user-api/                      # ç”¨æˆ·APIæœåŠ¡
    â”‚   â”œâ”€â”€ main.go                    # æœåŠ¡å…¥å£
    â”‚   â”œâ”€â”€ user.api                   # APIå®šä¹‰æ–‡ä»¶
    â”‚   â”œâ”€â”€ etc/                       # é…ç½®æ–‡ä»¶
    â”‚   â”‚   â””â”€â”€ user-api.yaml          # æœåŠ¡é…ç½®
    â”‚   â”œâ”€â”€ internal/                  # å†…éƒ¨å®ç°
    â”‚   â”‚   â”œâ”€â”€ config/                # é…ç½®ç»“æ„
    â”‚   â”‚   â”‚   â””â”€â”€ config.go
    â”‚   â”‚   â”œâ”€â”€ handler/               # HTTPå¤„ç†å™¨
    â”‚   â”‚   â”‚   â”œâ”€â”€ handler.go         # è·¯ç”±æ³¨å†Œ
    â”‚   â”‚   â”‚   â”œâ”€â”€ auth/              # è®¤è¯ç›¸å…³handler
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ register_handler.go
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ login_handler.go
    â”‚   â”‚   â”‚   â”œâ”€â”€ users/             # ç”¨æˆ·ç›¸å…³handler
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ user_handler.go
    â”‚   â”‚   â”‚   â””â”€â”€ admin/             # ç®¡ç†å‘˜ç›¸å…³handler
    â”‚   â”‚   â”‚       â””â”€â”€ admin_handler.go
    â”‚   â”‚   â”œâ”€â”€ logic/                 # ä¸šåŠ¡é€»è¾‘
    â”‚   â”‚   â”‚   â””â”€â”€ auth/              # è®¤è¯é€»è¾‘
    â”‚   â”‚   â”‚       â”œâ”€â”€ register_logic.go
    â”‚   â”‚   â”‚       â””â”€â”€ login_logic.go
    â”‚   â”‚   â”œâ”€â”€ middleware/            # ä¸­é—´ä»¶
    â”‚   â”‚   â”‚   â”œâ”€â”€ auth_middleware.go  # è®¤è¯ä¸­é—´ä»¶
    â”‚   â”‚   â”‚   â””â”€â”€ admin_middleware.go # ç®¡ç†å‘˜ä¸­é—´ä»¶
    â”‚   â”‚   â”œâ”€â”€ svc/                   # æœåŠ¡ä¸Šä¸‹æ–‡
    â”‚   â”‚   â”‚   â””â”€â”€ service_context.go
    â”‚   â”‚   â””â”€â”€ types/                 # ç±»å‹å®šä¹‰
    â”‚   â”‚       â””â”€â”€ types.go
    â”‚   â””â”€â”€ models/                    # æ•°æ®æ¨¡å‹
    â”‚       â”œâ”€â”€ user_model.go          # ç”¨æˆ·æ¨¡å‹
    â”‚       â”œâ”€â”€ user_token_model.go    # ç”¨æˆ·ä»¤ç‰Œæ¨¡å‹
    â”‚       â”œâ”€â”€ user_statistics_model.go # ç”¨æˆ·ç»Ÿè®¡æ¨¡å‹
    â”‚       â””â”€â”€ user_login_log_model.go # ç™»å½•æ—¥å¿—æ¨¡å‹
    â”‚
    â””â”€â”€ user-rpc/                      # ç”¨æˆ·RPCæœåŠ¡(å¾…å¼€å‘)
```

## ğŸ—ï¸ æ¶æ„è¯´æ˜

### 1. å¾®æœåŠ¡æ¶æ„
- **services/user-api**: ç”¨æˆ·HTTP APIæœåŠ¡ï¼Œå¤„ç†ç”¨æˆ·è®¤è¯ã€ä¿¡æ¯ç®¡ç†ç­‰
- **services/user-rpc**: ç”¨æˆ·RPCæœåŠ¡(å¾…å¼€å‘)ï¼Œæä¾›å†…éƒ¨æœåŠ¡è°ƒç”¨

### 2. åˆ†å±‚è®¾è®¡
- **Handlerå±‚**: å¤„ç†HTTPè¯·æ±‚ï¼Œå‚æ•°éªŒè¯
- **Logicå±‚**: ä¸šåŠ¡é€»è¾‘å¤„ç†
- **Modelå±‚**: æ•°æ®æŒä¹…åŒ–æ“ä½œ
- **Middlewareå±‚**: ä¸­é—´ä»¶ï¼Œå¦‚è®¤è¯ã€æƒé™æ§åˆ¶

### 3. å…¬å…±ç»„ä»¶
- **common/types**: è·¨æœåŠ¡å…±äº«çš„æ•°æ®ç±»å‹
- **common/utils**: é€šç”¨å·¥å…·å‡½æ•°
- **common/middleware**: å¯å¤ç”¨çš„ä¸­é—´ä»¶

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# 1. å¯åŠ¨åŸºç¡€è®¾æ–½æœåŠ¡
make start

# 2. åˆå§‹åŒ–æ•°æ®åº“
mysql -h localhost -P 3306 -u root -p < sql/init.sql

# 3. éªŒè¯æœåŠ¡çŠ¶æ€
make status
```

### 2. å¯åŠ¨ç”¨æˆ·æœåŠ¡
```bash
# ä½¿ç”¨å¯åŠ¨è„šæœ¬
./start-user-api.sh

# æˆ–æ‰‹åŠ¨å¯åŠ¨
cd services/user-api
go run main.go -f etc/user-api.yaml
```

### 3. æµ‹è¯•æ¥å£
```bash
# ç”¨æˆ·æ³¨å†Œ
curl -X POST http://localhost:8888/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com", 
    "password": "TestPass123!",
    "confirm_password": "TestPass123!",
    "role": "student"
  }'

# ç”¨æˆ·ç™»å½•
curl -X POST http://localhost:8888/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "TestPass123!"
  }'
```

## ğŸ“‹ å¼€å‘è§„èŒƒ

### 1. ä»£ç ç»“æ„è§„èŒƒ
- éµå¾ªgo-zeroé¡¹ç›®ç»“æ„çº¦å®š
- APIå®šä¹‰ä½¿ç”¨.apiæ–‡ä»¶
- ä¸šåŠ¡é€»è¾‘åœ¨logicå±‚å®ç°
- æ•°æ®æ“ä½œåœ¨modelå±‚å®ç°

### 2. å‘½åè§„èŒƒ
- æ–‡ä»¶åä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”
- ç»“æ„ä½“ä½¿ç”¨å¤§é©¼å³°å‘½å
- å‡½æ•°å’Œå˜é‡ä½¿ç”¨å°é©¼å³°å‘½å
- å¸¸é‡ä½¿ç”¨å…¨å¤§å†™ä¸‹åˆ’çº¿åˆ†éš”

### 3. é”™è¯¯å¤„ç†
- ä½¿ç”¨ç»Ÿä¸€çš„é”™è¯¯ç å’Œé”™è¯¯æ¶ˆæ¯
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•
- å‹å¥½çš„ç”¨æˆ·é”™è¯¯æç¤º

## ğŸ”§ é…ç½®è¯´æ˜

### 1. æœåŠ¡é…ç½®
é…ç½®æ–‡ä»¶ä½ç½®: `services/user-api/etc/user-api.yaml`

ä¸»è¦é…ç½®é¡¹:
- æœåŠ¡ç«¯å£å’Œåœ°å€
- æ•°æ®åº“è¿æ¥ä¿¡æ¯
- Redisè¿æ¥ä¿¡æ¯
- JWTå¯†é’¥é…ç½®
- ä¸šåŠ¡é…ç½®(å¯†ç ç­–ç•¥ã€åˆ†é¡µç­‰)

### 2. æ•°æ®åº“é…ç½®
- MySQL: ä¸»æ•°æ®åº“ï¼Œå­˜å‚¨ä¸šåŠ¡æ•°æ®
- Redis: ç¼“å­˜å’Œä¼šè¯å­˜å‚¨
- è¿æ¥æ± é…ç½®ä¼˜åŒ–

### 3. æ—¥å¿—é…ç½®
- ç»“æ„åŒ–æ—¥å¿—è¾“å‡º
- ä¸åŒçº§åˆ«çš„æ—¥å¿—è®°å½•
- æ—¥å¿—è½®è½¬å’Œæ¸…ç†

## ğŸ“Š ç›‘æ§å’Œè¿ç»´

### 1. å¥åº·æ£€æŸ¥
- æœåŠ¡å¥åº·çŠ¶æ€æ£€æŸ¥
- æ•°æ®åº“è¿æ¥çŠ¶æ€æ£€æŸ¥
- å¤–éƒ¨ä¾èµ–æœåŠ¡æ£€æŸ¥

### 2. æ€§èƒ½ç›‘æ§
- PrometheusæŒ‡æ ‡æ”¶é›†
- Grafanaå¯è§†åŒ–é¢æ¿
- å…³é”®ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§

### 3. æ—¥å¿—åˆ†æ
- ELKæ—¥å¿—èšåˆåˆ†æ
- é”™è¯¯æ—¥å¿—å‘Šè­¦
- æ€§èƒ½ç“¶é¢ˆåˆ†æ

## ğŸ”’ å®‰å…¨æªæ–½

### 1. æ•°æ®å®‰å…¨
- å¯†ç bcryptåŠ å¯†å­˜å‚¨
- æ•æ„Ÿä¿¡æ¯ä¸è®°å½•æ—¥å¿—
- æ•°æ®åº“è¿æ¥åŠ å¯†

### 2. æ¥å£å®‰å…¨
- JWTä»¤ç‰Œè®¤è¯
- è¯·æ±‚é¢‘ç‡é™åˆ¶
- å‚æ•°éªŒè¯å’Œè¿‡æ»¤

### 3. ç³»ç»Ÿå®‰å…¨
- å®¹å™¨åŒ–éƒ¨ç½²éš”ç¦»
- ç½‘ç»œè®¿é—®æ§åˆ¶
- å®šæœŸå®‰å…¨æ›´æ–°

## ğŸ“ åç»­å¼€å‘è®¡åˆ’

### Phase 1: åŸºç¡€åŠŸèƒ½å®Œå–„
- [ ] å®Œå–„æ‰€æœ‰handlerå®ç°
- [ ] æ·»åŠ å‚æ•°éªŒè¯
- [ ] å®Œå–„é”™è¯¯å¤„ç†
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–

### Phase 2: é«˜çº§åŠŸèƒ½
- [ ] é‚®ç®±éªŒè¯åŠŸèƒ½
- [ ] ç¬¬ä¸‰æ–¹ç™»å½•é›†æˆ
- [ ] åŒå› å­è®¤è¯
- [ ] ç”¨æˆ·è¡Œä¸ºåˆ†æ

### Phase 3: æ€§èƒ½ä¼˜åŒ–
- [ ] æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- [ ] ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
- [ ] å¹¶å‘æ€§èƒ½æå‡
- [ ] è´Ÿè½½æµ‹è¯•å’Œè°ƒä¼˜

### Phase 4: è¿ç»´å¢å¼º
- [ ] ç›‘æ§å‘Šè­¦å®Œå–„
- [ ] è‡ªåŠ¨åŒ–éƒ¨ç½²
- [ ] æ—¥å¿—åˆ†æå¢å¼º
- [ ] å¤‡ä»½æ¢å¤æœºåˆ¶

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤ä»£ç å˜æ›´
4. åˆ›å»ºPull Request
5. ä»£ç å®¡æŸ¥å’Œåˆå¹¶

## ğŸ“ è”ç³»æ–¹å¼

- é¡¹ç›®åœ°å€: [GitHub Repository]
- æŠ€æœ¯æ–‡æ¡£: `docs/` ç›®å½•
- é—®é¢˜åé¦ˆ: [GitHub Issues]